(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{eI7X:function(e,t,n){"use strict";n.r(t),n.d(t,"HistoryMapPageModule",(function(){return M}));var i=n("ofXK"),o=n("3Pt+"),a=n("TEn/"),r=n("tyNb"),s=n("mrSG"),l=n("NV1z"),d=n("tBOM"),c=n("tmoB"),m=n("wd/R"),p=n("6HIw"),u=n("fXoL"),h=n("X2iB"),g=n("C6fG"),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Object(s.b)(t,e),t.prototype.open=function(e,t){return Object(g.cordova)(this,"open",{callbackStyle:"object",successName:"success",errorName:"error"},arguments)},t.prototype.uninstall=function(e){return Object(g.cordova)(this,"uninstall",{callbackStyle:"object",successName:"success",errorName:"error"},arguments)},t.prototype.appIsInstalled=function(e){return Object(g.cordova)(this,"appIsInstalled",{callbackStyle:"object",successName:"success",errorName:"error"},arguments)},t.prototype.showOpenWithDialog=function(e,t){return Object(g.cordova)(this,"showOpenWithDialog",{callbackStyle:"object",successName:"success",errorName:"error"},arguments)},t.pluginName="FileOpener",t.plugin="cordova-plugin-file-opener2",t.pluginRef="cordova.plugins.fileOpener2",t.repo="https://github.com/pwlin/cordova-plugin-file-opener2",t.platforms=["Android","iOS","Windows","Windows Phone 8"],t.\u0275fac=function(e){return n(e||t)},t.\u0275prov=u["\u0275\u0275defineInjectable"]({token:t,factory:function(e){return t.\u0275fac(e)}});var n=u["\u0275\u0275getInheritedFactory"](t);return t}(g.IonicNativePlugin),v=n("FAH8");function y(e,t){if(1&e&&(u["\u0275\u0275elementStart"](0,"span",22),u["\u0275\u0275text"](1),u["\u0275\u0275pipe"](2,"date"),u["\u0275\u0275elementEnd"]()),2&e){const e=u["\u0275\u0275nextContext"]();u["\u0275\u0275advance"](1),u["\u0275\u0275textInterpolate2"](" ",u["\u0275\u0275pipeBind2"](2,2,e.dateRange.from,"dd/MM/yyyy")," - ",e.device.license_plate," ")}}function b(e,t){1&e&&u["\u0275\u0275element"](0,"ion-spinner",23)}function S(e,t){if(1&e){const e=u["\u0275\u0275getCurrentView"]();u["\u0275\u0275elementStart"](0,"ion-item",24),u["\u0275\u0275elementStart"](1,"ion-range",25),u["\u0275\u0275listener"]("ngModelChange",(function(t){return u["\u0275\u0275restoreView"](e),u["\u0275\u0275nextContext"]().valueRange=t}))("ionChange",(function(t){return u["\u0275\u0275restoreView"](e),u["\u0275\u0275nextContext"]().changeMarker(t)})),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](2,"div",3),u["\u0275\u0275text"](3),u["\u0275\u0275pipe"](4,"date"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"]()}if(2&e){const e=u["\u0275\u0275nextContext"]();u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("ngModel",e.valueRange)("max",e.routes.length-1),u["\u0275\u0275advance"](2),u["\u0275\u0275textInterpolate1"](" ",u["\u0275\u0275pipeBind2"](4,3,e.datePoint,"HH:mm:ss")," ")}}function x(e,t){if(1&e){const e=u["\u0275\u0275getCurrentView"]();u["\u0275\u0275elementStart"](0,"ion-item",26),u["\u0275\u0275listener"]("click",(function(){u["\u0275\u0275restoreView"](e);const n=t.$implicit,i=t.index;return u["\u0275\u0275nextContext"]().selectTrip(n,i+1)})),u["\u0275\u0275elementStart"](1,"div",27),u["\u0275\u0275elementStart"](2,"div"),u["\u0275\u0275text"](3),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](4,"ion-label"),u["\u0275\u0275elementStart"](5,"p"),u["\u0275\u0275element"](6,"ion-icon",28),u["\u0275\u0275elementStart"](7,"b"),u["\u0275\u0275text"](8," In\xedcio:"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275text"](9),u["\u0275\u0275pipe"](10,"date"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](11,"p"),u["\u0275\u0275element"](12,"ion-icon",20),u["\u0275\u0275elementStart"](13,"b"),u["\u0275\u0275text"](14," Fim:"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275text"](15),u["\u0275\u0275pipe"](16,"date"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](17,"p"),u["\u0275\u0275element"](18,"ion-icon",20),u["\u0275\u0275elementStart"](19,"b"),u["\u0275\u0275text"](20," Dura\xe7\xe3o:"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275text"](21),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](22,"p"),u["\u0275\u0275element"](23,"ion-icon",20),u["\u0275\u0275elementStart"](24,"b"),u["\u0275\u0275text"](25," Dist\xe2ncia:"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275text"](26),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit,n=t.index,i=u["\u0275\u0275nextContext"]();u["\u0275\u0275property"]("ngClass",n+1===i.trip_select?"selected":""),u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("ngClass",void 0===e.endLon?"red":"black"),u["\u0275\u0275advance"](2),u["\u0275\u0275textInterpolate"](void 0===e.endLon?"PARADA":"VIAGEM"),u["\u0275\u0275advance"](6),u["\u0275\u0275textInterpolate1"](" ",u["\u0275\u0275pipeBind2"](10,7,e.startTime,"dd/MM/yyyy HH:mm")," "),u["\u0275\u0275advance"](6),u["\u0275\u0275textInterpolate1"](" ",u["\u0275\u0275pipeBind2"](16,10,e.endTime,"dd/MM/yyyy HH:mm")," "),u["\u0275\u0275advance"](6),u["\u0275\u0275textInterpolate1"](" ",i.formatValueHours(e.duration)," "),u["\u0275\u0275advance"](5),u["\u0275\u0275textInterpolate1"](" ",i.formatDistance(e.distance)," km ")}}const w=[{path:"",component:(()=>{class e extends l.a{constructor(e,t,n,i,o,a){super(e),this.loadCtrl=t,this.deviceService=n,this.fileOpener=i,this.file=o,this.navCtrl_=a,this.routes=[],this.valueRange=0,this.trip_select=-1,this.dateRange={from:"",to:""},this.isShowLoading=!1,this.device=new c.a}ngOnInit(){return Object(s.a)(this,void 0,void 0,(function*(){this.loadMap(),this.detachMap(),yield this.showLoadingView({showOverlay:!1}),this.isShowLoading=!0,yield this.getDevice(),yield this.getSummary(),yield this.getRoutes(),yield this.pointsMap(),yield this.getTrips(),yield this.getStops(),this.isShowLoading=!1,yield this.showContentView()}))}ionViewDidEnter(){return Object(s.a)(this,void 0,void 0,(function*(){this.myPane&&(console.log("==== ionViewDidEnter"),this.myPane.destroy()),this.myPane=new p.a(".cupertino-pane2",{buttonClose:!1,breaks:{middle:{enabled:!0,height:280,bounce:!0},bottom:{enabled:!0,height:150}},onDrag:()=>{}}),this.myPane.present({animate:!0})}))}ionViewDidLeave(){}detachMap(){this.map1&&this.map1.clear()}enableMenuSwipe(){return!1}getRoutes(){return Object(s.a)(this,void 0,void 0,(function*(){const{data:e}=yield this.deviceService.routes(this.id,this.dateRange.from,this.dateRange.to);this.routes=e}))}getRoutesDownload(){return Object(s.a)(this,void 0,void 0,(function*(){this.loading=yield this.loadCtrl.create({message:"Aguarde..."}),yield this.loading.present();const{data:e}=yield this.deviceService.routeDownload(this.id,this.dateRange.from,this.dateRange.to);if(e){var t=new Blob([e],{type:"application/vnd.ms-excel"});this.file.writeFile(this.file.dataDirectory,"relatorio.xlsx",t,{replace:!0}).then(e=>{this.fileOpener.open(this.file.dataDirectory+"relatorio.xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),this.loading.dismiss()})}}))}getSummary(){return Object(s.a)(this,void 0,void 0,(function*(){const{data:e}=yield this.deviceService.summary(this.id,this.dateRange.from,this.dateRange.to);this.summary=e[0]}))}getTrips(){return Object(s.a)(this,void 0,void 0,(function*(){const{data:e}=yield this.deviceService.trips(this.id,this.dateRange.from,this.dateRange.to);this.trips=e}))}getStops(){return Object(s.a)(this,void 0,void 0,(function*(){const{data:e}=yield this.deviceService.stops(this.id,this.dateRange.from,this.dateRange.to);this.trips.push(...e),this.trips.sort((function(e,t){return Number(new Date(e.startTime))-Number(new Date(t.startTime))}))}))}pointsMap(){return Object(s.a)(this,void 0,void 0,(function*(){let e=this.routes.map((function(e){return{lat:e.latitude,lng:e.longitude}}));Array.isArray(e)&&e.length&&(this.map1.addPolylineSync({points:e,width:3}),yield this.map1.moveCamera({target:e}),this.marker=this.map1.addMarkerSync({title:this.device.license_plate,position:{lat:e[0].lat,lng:e[0].lng}}))}))}clearMap(){return Object(s.a)(this,void 0,void 0,(function*(){this.valueRange=0,yield this.map1.clear()}))}changeMarker(e){let t=e.detail.value;this.datePoint=this.routes[t].deviceTime,this.marker.setPosition({lat:this.routes[t].latitude,lng:this.routes[t].longitude}),this.marker.setTitle("Velocidade: "+this.formatSpeed(this.routes[t].speed)+" km/h \n\r Hora: "+m(this.routes[t].deviceTime).format("DD/MM/YYYY HH:mm:ss"))}graphicModal(){return Object(s.a)(this,void 0,void 0,(function*(){this.navCtrl_.navigateForward(["/history-graphic"],{state:{routes:this.routes}})}))}getDevice(){return Object(s.a)(this,void 0,void 0,(function*(){let e=this.getParams();if(e){this.dateRange.from=m(e.date).startOf("day").format(),this.dateRange.to=m(e.date).endOf("day").format(),this.id=e.id;const{success:t,data:n}=yield this.deviceService.GetById(String(this.id));t&&(this.device=n)}}))}selectTrip(e,t){return Object(s.a)(this,void 0,void 0,(function*(){this.datePoint=null,this.myPane.moveToHeight(280),this.trip_select=t,this.dateRange.from=m(e.startTime).format(),this.dateRange.to=m(e.endTime).format(),yield this.clearMap(),yield this.getRoutes(),yield this.pointsMap()}))}selectAllDay(){return Object(s.a)(this,void 0,void 0,(function*(){if(-1===this.trip_select)return;this.trip_select=-1,this.myPane.moveToHeight(280),this.datePoint=null;let e=this.getParams();e&&(this.dateRange.from=m(e.date).startOf("day").format(),this.dateRange.to=m(e.date).endOf("day").format(),yield this.clearMap(),yield this.getRoutes(),yield this.pointsMap())}))}loadMap(){this.map1=d.b.create("map_canvas",{camera:{target:{lat:-3.732594,lng:-38.526213},zoom:12,tilt:0},controls:{compass:!1,myLocationButton:!1,myLocation:!1,indoorPicker:!0,zoom:!1,mapToolbar:!0}})}formatDistance(e){return""+(.001*e).toFixed(2)}formatSpeed(e){return""+(1.852*e).toFixed(2)}formatValueHours(e,t=!0){var n,i;return t?(n=Math.floor(e/36e5),i=Math.floor(e%36e5/6e4)):(n=Math.floor(e),i=Math.floor(e%1*60)),n+" h "+i+" m"}ngOnDestroy(){this.map1.clear()}goToHistory(){this.goBack()}}return e.\u0275fac=function(t){return new(t||e)(u["\u0275\u0275directiveInject"](u.Injector),u["\u0275\u0275directiveInject"](a.LoadingController),u["\u0275\u0275directiveInject"](h.a),u["\u0275\u0275directiveInject"](f),u["\u0275\u0275directiveInject"](v.a),u["\u0275\u0275directiveInject"](a.NavController))},e.\u0275cmp=u["\u0275\u0275defineComponent"]({type:e,selectors:[["app-history-map"]],features:[u["\u0275\u0275InheritDefinitionFeature"]],decls:37,vars:7,consts:[["mode","ios"],["size","small","color","medium-contrast",1,"map-back",3,"click"],["name","chevron-back"],[1,"ion-text-center"],["class","ion-text-wrap",4,"ngIf"],["name","crescent","color","dark",4,"ngIf"],["class","slide",4,"ngIf"],["id","map_canvas",1,"map"],[1,"cupertino-pane2"],[1,"header"],["fixed",""],[1,"acoes"],[1,"scrollable"],["size","6"],["expand","full","color","dark","fill","outline","shape","round",3,"click"],["name","calendar"],["name","lock-closed"],["overflow-y","",1,"content"],[3,"click"],[1,"date","black"],["name","speedometer-outline"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"ion-text-wrap"],["name","crescent","color","dark"],[1,"slide"],["dualKnobs","false","min","0","step","1","snaps","true",3,"ngModel","max","ngModelChange","ionChange"],[3,"ngClass","click"],[1,"date",3,"ngClass"],["name","analytics-outline"]],template:function(e,t){1&e&&(u["\u0275\u0275elementStart"](0,"ion-header"),u["\u0275\u0275elementStart"](1,"ion-toolbar",0),u["\u0275\u0275elementStart"](2,"ion-fab-button",1),u["\u0275\u0275listener"]("click",(function(){return t.goToHistory()})),u["\u0275\u0275element"](3,"ion-icon",2),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](4,"ion-title",3),u["\u0275\u0275template"](5,y,3,5,"span",4),u["\u0275\u0275template"](6,b,1,0,"ion-spinner",5),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275template"](7,S,5,6,"ion-item",6),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](8,"ion-content"),u["\u0275\u0275element"](9,"div",7),u["\u0275\u0275elementStart"](10,"div",8),u["\u0275\u0275elementStart"](11,"div",9),u["\u0275\u0275elementStart"](12,"ion-grid",10),u["\u0275\u0275elementStart"](13,"div",11),u["\u0275\u0275elementStart"](14,"ion-row",12),u["\u0275\u0275elementStart"](15,"ion-col",13),u["\u0275\u0275elementStart"](16,"ion-button",14),u["\u0275\u0275listener"]("click",(function(){return t.graphicModal()})),u["\u0275\u0275element"](17,"ion-icon",15),u["\u0275\u0275text"](18," Gr\xe1ficos "),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](19,"ion-col",13),u["\u0275\u0275elementStart"](20,"ion-button",14),u["\u0275\u0275listener"]("click",(function(){return t.getRoutesDownload()})),u["\u0275\u0275element"](21,"ion-icon",16),u["\u0275\u0275text"](22," Exportar "),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](23,"div",17),u["\u0275\u0275elementStart"](24,"ion-item",18),u["\u0275\u0275listener"]("click",(function(){return t.selectAllDay()})),u["\u0275\u0275elementStart"](25,"div",19),u["\u0275\u0275elementStart"](26,"div"),u["\u0275\u0275text"](27,"Dia Todo"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](28,"ion-label"),u["\u0275\u0275element"](29,"br"),u["\u0275\u0275elementStart"](30,"p"),u["\u0275\u0275element"](31,"ion-icon",20),u["\u0275\u0275elementStart"](32,"b"),u["\u0275\u0275text"](33," Dist\xe2ncia:"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275text"](34),u["\u0275\u0275elementEnd"](),u["\u0275\u0275element"](35,"br"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275template"](36,x,27,13,"ion-item",21),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"]()),2&e&&(u["\u0275\u0275advance"](5),u["\u0275\u0275property"]("ngIf",!t.isLoadingViewVisible),u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("ngIf",t.isLoadingViewVisible),u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("ngIf",t.routes.length>0),u["\u0275\u0275advance"](17),u["\u0275\u0275classProp"]("selected",-1===t.trip_select),u["\u0275\u0275advance"](10),u["\u0275\u0275textInterpolate1"]("",t.formatDistance(null==t.summary?null:t.summary.distance)," km "),u["\u0275\u0275advance"](2),u["\u0275\u0275property"]("ngForOf",t.trips))},directives:[a.IonHeader,a.IonToolbar,a.IonFabButton,a.IonIcon,a.IonTitle,i.NgIf,a.IonContent,a.IonGrid,a.IonRow,a.IonCol,a.IonButton,a.IonItem,a.IonLabel,i.NgForOf,a.IonSpinner,a.IonRange,a.SelectValueAccessor,o.NgControlStatus,o.NgModel,i.NgClass],pipes:[i.DatePipe],styles:[".date[_ngcontent-%COMP%]{margin-right:15px;padding:15px;border-radius:10px;text-align:center;font-weight:700;color:#fff}.toolbar-title[_ngcontent-%COMP%]{text-overflow:unset;white-space:unset}.black[_ngcontent-%COMP%]{background-color:#000}.red[_ngcontent-%COMP%]{background-color:red}.content[_ngcontent-%COMP%]{margin-bottom:50px;padding-bottom:180px}#map_canvas[_ngcontent-%COMP%]{width:100%;min-height:300px;height:100%}.acoes[_ngcontent-%COMP%]{background-color:#fff}.acoes[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#393e46;font-size:24px;margin-right:10px}.selected[_ngcontent-%COMP%]{--background:#eee}"]}),e})()}];let I=(()=>{class e{}return e.\u0275mod=u["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=u["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[r.j.forChild(w)],r.j]}),e})(),M=(()=>{class e{}return e.\u0275mod=u["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=u["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},providers:[f],imports:[[i.CommonModule,o.FormsModule,a.IonicModule,I]]}),e})()}}]);